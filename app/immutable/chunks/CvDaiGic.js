import{i as t,p as e}from"./BrovVaEf.js";import"./BCwM8zZG.js";import"./C-Yhni3d.js";import"./CaceulcS.js";import"./iOaMc-fg.js";import"./3wT5GJNP.js";import"./BN6jBIBS.js";import"./BgMah_2i.js";import"./Ceawk7PV.js";import{g as a,h as n}from"./C7VJpUc4.js";import{B as i,C as r,U as l,_ as o,a as s,b as p,c,d as u,v as d,z as f}from"./Mg0B-8hR.js";import{t as m}from"./DJRdgUvI.js";import{n as g}from"./CO7NjjwJ.js";import{p as h}from"./CLEiZXIm.js";import{t as w}from"./DfWr_bMu.js";import{t as x}from"./CK_g-zYT.js";import{t as y}from"./D0afOe8M.js";import"./CxvMQ2RB.js";import{t as v}from"./84FuF-rq.js";import{t as S}from"./Dv8t_UyV.js";function $(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function j(t){return t}var A=u.pie,b={sections:new Map,showData:!1,config:A},T=b.sections,C=b.showData,D=structuredClone(A),k={getConfig:n(()=>structuredClone(D),"getConfig"),clear:n(()=>{T=new Map,C=b.showData,s()},"clear"),setDiagramTitle:l,getDiagramTitle:r,setAccTitle:i,getAccTitle:d,setAccDescription:f,getAccDescription:o,addSection:n(({label:t,value:e})=>{if(e<0)throw new Error(`"${t}" has invalid value: ${e}. Negative values are not allowed in pie charts. All slice values must be >= 0.`);T.has(t)||(T.set(t,e),a.debug(`added new section: ${t}, with value: ${e}`))},"addSection"),getSections:n(()=>T,"getSections"),setShowData:n(t=>{C=t},"setShowData"),getShowData:n(()=>C,"getShowData")},M=n((t,e)=>{v(t,e),e.setShowData(t.showData),t.sections.map(e.addSection)},"populateDb"),z={parse:n(async t=>{const e=await S("pie",t);a.debug(e),M(e,k)},"parse")},O=n(t=>`\n  .pieCircle{\n    stroke: ${t.pieStrokeColor};\n    stroke-width : ${t.pieStrokeWidth};\n    opacity : ${t.pieOpacity};\n  }\n  .pieOuterCircle{\n    stroke: ${t.pieOuterStrokeColor};\n    stroke-width: ${t.pieOuterStrokeWidth};\n    fill: none;\n  }\n  .pieTitleText {\n    text-anchor: middle;\n    font-size: ${t.pieTitleTextSize};\n    fill: ${t.pieTitleTextColor};\n    font-family: ${t.fontFamily};\n  }\n  .slice {\n    font-family: ${t.fontFamily};\n    fill: ${t.pieSectionTextColor};\n    font-size:${t.pieSectionTextSize};\n    // fill: white;\n  }\n  .legend text {\n    fill: ${t.pieLegendTextColor};\n    font-family: ${t.fontFamily};\n    font-size: ${t.pieLegendTextSize};\n  }\n`,"getStyles"),F=n(t=>{const e=[...t.values()].reduce((t,e)=>t+e,0),a=[...t.entries()].map(([t,e])=>({label:t,value:e})).filter(t=>t.value/e*100>=1).sort((t,e)=>e.value-t.value);return function(){var t=j,e=$,a=null,n=g(0),i=g(h),r=g(0);function l(l){var o,s,p,c,u,d=(l=x(l)).length,f=0,m=new Array(d),g=new Array(d),w=+n.apply(this,arguments),y=Math.min(h,Math.max(-h,i.apply(this,arguments)-w)),v=Math.min(Math.abs(y)/d,r.apply(this,arguments)),S=v*(y<0?-1:1);for(o=0;o<d;++o)(u=g[m[o]=o]=+t(l[o],o,l))>0&&(f+=u);for(null!=e?m.sort(function(t,a){return e(g[t],g[a])}):null!=a&&m.sort(function(t,e){return a(l[t],l[e])}),o=0,p=f?(y-d*S)/f:0;o<d;++o,w=c)s=m[o],c=w+((u=g[s])>0?u*p:0)+S,g[s]={data:l[s],index:o,value:u,startAngle:w,endAngle:c,padAngle:v};return g}return l.value=function(e){return arguments.length?(t="function"==typeof e?e:g(+e),l):t},l.sortValues=function(t){return arguments.length?(e=t,a=null,l):e},l.sort=function(t){return arguments.length?(a=t,e=null,l):a},l.startAngle=function(t){return arguments.length?(n="function"==typeof t?t:g(+t),l):n},l.endAngle=function(t){return arguments.length?(i="function"==typeof t?t:g(+t),l):i},l.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:g(+t),l):r},l}().value(t=>t.value)(a)},"createPieArcs"),R={parser:z,db:k,renderer:{draw:n((n,i,r,l)=>{a.debug("rendering pie chart\n"+n);const o=l.db,s=p(),u=t(o.getConfig(),s.pie),d=18,f=450,g=f,h=y(i),x=h.append("g");x.attr("transform","translate(225,225)");const{themeVariables:v}=s;let[S]=e(v.pieOuterStrokeWidth);S??=2;const $=u.textPosition,j=Math.min(g,f)/2-40,A=w().innerRadius(0).outerRadius(j),b=w().innerRadius(j*$).outerRadius(j*$);x.append("circle").attr("cx",0).attr("cy",0).attr("r",j+S/2).attr("class","pieOuterCircle");const T=o.getSections(),C=F(T),D=[v.pie1,v.pie2,v.pie3,v.pie4,v.pie5,v.pie6,v.pie7,v.pie8,v.pie9,v.pie10,v.pie11,v.pie12];let k=0;T.forEach(t=>{k+=t});const M=C.filter(t=>"0"!==(t.data.value/k*100).toFixed(0)),z=m(D);x.selectAll("mySlices").data(M).enter().append("path").attr("d",A).attr("fill",t=>z(t.data.label)).attr("class","pieCircle"),x.selectAll("mySlices").data(M).enter().append("text").text(t=>(t.data.value/k*100).toFixed(0)+"%").attr("transform",t=>"translate("+b.centroid(t)+")").style("text-anchor","middle").attr("class","slice"),x.append("text").text(o.getDiagramTitle()).attr("x",0).attr("y",-200).attr("class","pieTitleText");const O=[...T.entries()].map(([t,e])=>({label:t,value:e})),R=x.selectAll(".legend").data(O).enter().append("g").attr("class","legend").attr("transform",(t,e)=>"translate(216,"+(22*e-22*O.length/2)+")");R.append("rect").attr("width",d).attr("height",d).style("fill",t=>z(t.label)).style("stroke",t=>z(t.label)),R.append("text").attr("x",22).attr("y",14).text(t=>o.getShowData()?`${t.label} [${t.value}]`:t.label);const W=512+Math.max(...R.selectAll("text").nodes().map(t=>t?.getBoundingClientRect().width??0));h.attr("viewBox",`0 0 ${W} 450`),c(h,f,W,u.useMaxWidth)},"draw")},styles:O};export{R as diagram};